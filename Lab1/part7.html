<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bar Chart</title>
</head>
<body>
<script src='https://d3js.org/d3.v7.min.js'></script>
<style>
    svg rect {}
    svg text {fill:white;
              font: 10px sans-serif;
              text-anchor: end;
             }
</style>
<script>
    let heartfailurecsv = 'https://raw.githubusercontent.com/akmand/datasets/master/heart_failure.csv';
    var width = 2000;
    var scaleFactor = 1;
    var barHeight = 20;

    var result = [0, 0, 0, 0]
    //exercise 14
    d3.csv(heartfailurecsv).then(function(data) {
        for (let i = 0; i < data.length; i++) {
            if (1 <= data[i].age && data[i].age <= 30) {
                result[0]++;
            } else if (31 <= data[i].age && data[i].age <= 40) {
                result[1]++;
            } else if (41 <= data[i].age && data[i].age <= 60) {
                result[2]++;
            } else if (61 <= data[i].age && data[i].age <= 100) {
                result[3]++;
            }
        }
    }).then(function (){
        var graph = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", barHeight * result.length);

        var bar = graph.selectAll("g")
            .data(result)
            .enter()
            .append("g")
            .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });
        bar.append("rect")
            .attr("width", function(d) { return d * scaleFactor; })
            .attr("height", barHeight - 1)
            //exercise 15
            .attr("fill", function (d, i){
                if (d > 100){
                    return "red";
                }else {
                    return "blue";
                }
            });
        bar.append("text")
            .attr("x", function(d) { return d * scaleFactor; })
            .attr("y", barHeight / 2)
            .attr("dy", ".35em")
            .text(function(d) { return d; });
    });

</script>
</body>
</html>